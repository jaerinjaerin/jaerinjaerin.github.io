# TypeScript로 NextResponse 객체 견고하게 만들기

태그: NextJS, TypeScript

## 🍟 NextResponse에 전달할 타입을 지정하는 방법

클라이언트에서 서버 요청에 대한 응답을 받을 때, 성공케이스와 실패케이스의 응답 구조가 어느정도는 정규화가 되어있어야 처리를 하기 편했습니다. 

그래서 api 서버 작업을 할 때, response 객체에 전달하는 데이터에 특정 프로퍼티가 빠진 경우 타입에러를 낼 수 있도록 지정해주고 싶었습니다. 

```tsx
// 성공케이스 
return NextResponse.json({
  success: true,
  data: ticket,
  message: "Successfully retrived image generations",
});

// 실패케이스 
return NextResponse.json({
  success: false,
  error: {
    code: "INTERNAL_SERVER_ERROR",
    message: "Something went wrong",
  },
});
```

### 🚥 고민해본 것들

- data는 어떤 타입을 가지고 있을 지 모르는 배열이다.
- Response 객체의 구조는 항상 유지한다.

### 🚥 구현하기

ApiResponse에 대한 타입을 `types/api/response/index.ts`에 지정합니다.

```tsx
// data에 들어갈 구조는 알 수 없으니 제네릭으로 선언한다. 
export type ApiSuccessResponse<T> = {
  success: true;
  data: T;
  message: string;
};

export type ApiErrorResponse = {
  success: false;
  error: {
    code: string;
    message: string;
  };
  status: number;
};

export type ApiResponse<T> = ApiSuccessResponse<T> | ApiErrorResponse;

```

리턴타입을 `Promise<NextResponse<ApiResponse<>>` 로 명시해줍니다.

➡️ 현재는 Ticket 모델 데이터를 가져오기 때문에 `<Ticket[]>`을 T값에 전달했습니다.

```tsx
export async function GET(
  request: NextRequest,
  { params }: userIdRouterParams
): Promise<**NextResponse<ApiResponse<Ticket[]>>**> {
  try {
    const { userId } = await params;

    const ticket = await prisma.ticket.findMany({
      where: { userId },
    });

    return NextResponse.json({
      success: true,
      data: ticket,
      message: "Successfully retrieved tickets",
    });
  } catch (error) {
    return NextResponse.json({
      success: false,
      error: {
        code: "INTERNAL_SERVER_ERROR",
        message: "Something went wrong",
      },
    });
  }
}
```

### 🚥 리턴 객체에 어떤 값을 빠뜨렸는지 알 수 있습니다.

같이 작업하는 경우, 리턴 타입을 지정하지 않으면 여러 유형의 리턴타입을 받게되는데 이렇게 타입을 정의하면 규격화할 수 있는 장점이 있습니다.

![image.png](TypeScript%EB%A1%9C%20NextResponse%20%EA%B0%9D%EC%B2%B4%20%EA%B2%AC%EA%B3%A0%ED%95%98%EA%B2%8C%20%EB%A7%8C%EB%93%A4%EA%B8%B0%201f3b717d4315805ebb8ed9f7f30ae1de/image.png)